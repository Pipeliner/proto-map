<HTML>
	<head>
	<title>Map prototype</title>
	<meta charset="UTF-8" />

	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
	<!--[if lte IE 8]>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.ie.css" />
	<![endif]-->

	</head>



	<body>
	<script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>
	<div id="map" style="wigth: 100%; height: 100%; position: relative;"></div>

	<script>

	var marker1 = L.marker([59.934289, 30.306667], {title:'Исаакиевский собор'}).bindPopup('<a href="http://goo.gl/2QeN1" target="_blank">Исаакиевский собор</a>'),
		marker2 = L.marker([59.933333, 30.343333], {title:'Аничков мост'}).bindPopup('<a href="http://goo.gl/sLcGk" target="_blank">Аничков мост</a>'),
		marker3 = L.marker([59.935833, 30.325556], {title:'Дом книги'}).bindPopup('<a href="http://goo.gl/U7Hje" target="_blank">Дом книги</a>'),
		marker4 = L.marker([59.940161, 30.328597], {title:'Спас на Крови'}).bindPopup('<a href="http://goo.gl/YYRfm" target="_blank">Спас на Крови</a>');
		marker5 = L.marker([59.940556, 30.313611], {title:'Государственный Эрмитаж'}).bindPopup('<a href="http://goo.gl/RpoSm" target="_blank">Государственный Эрмитаж</a>');

	var architecture = L.layerGroup([marker2, marker3]),
		cathedrals = L.layerGroup([marker1, marker4]),
		museums = L.layerGroup([marker5]),
		monuments = L.layerGroup([]),
		theatres = L.layerGroup([]);

	var cloudmadeUrl = 'http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png',
	cloudmadeAttribution = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'

	var map = L.map('map', {
	center: new L.LatLng(59.9316, 30.3263),
	zoom: 12,
	doubleClickZoom: false
	});
	   L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>'
		}).addTo(map);

		function onLocationFound(e) {
			var radius = e.accuracy / 2;
			
			var redIcon = L.icon({
				iconUrl: 'marker-icon-red.png',
				iconSize: [25, 41], // size of the icon
			});

			var geolocMarker = L.marker(e.latlng, {icon: redIcon}).addTo(map);
            geolocMarker.bindPopup("Вы в радиусе " + radius + " метров отсюда");
            var circle = L.circle(e.latlng, radius).addTo(map);
			
			function onMapClick(e) {
				map.doubleClickZoom.enable();
				geolocMarker.setLatLng(e.latlng);
				circle.setLatLng(e.latlng, radius);
			}

			map.on('dblclick', onMapClick);
			
			map.setView(e.latlng, 12);
		}

		function onLocationError(e) {
			alert(e.message);
		}

		map.on('locationfound', onLocationFound);
		map.on('locationerror', onLocationError);

		map.locate();



	var overlayMaps = {
	"Архитектура": architecture,	
	"Музеи": museums,
	"Памятники": monuments,
	"Театры": theatres,
	"Храмы": cathedrals

	};

	L.control.layers(null, overlayMaps).addTo(map);

		</script>
		
	</body>
	</HTML>